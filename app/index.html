<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Authors</title>
    <script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
    <script src="//code.jquery.com/jquery-migrate-1.2.1.min.js"></script>
    <script src="../Scripts/angular.min.js"></script>
    <script src="../Scripts/jquery.xml2json.js"></script>
    <script src="../Scripts/bootstrap.min.js"></script>
                    <!--<script src="modules.js"></script>-->
    <script src="app.js"></script>

    <!-- datatables reference -->
    <script src="https://cdn.datatables.net/1.10.10/js/jquery.dataTables.min.js"></script>
    <script src="../angular-datatables.min.js"></script>
    <!--<link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.10.10/css/jquery.dataTables.min.css">-->
     <link rel="stylesheet" type="text/css" href="../Content/bootstrap.min.css">
    <link rel="stylesheet" type="text/css" href="../Content/datatables.min.css" />

</head>
<body>
    
        <span class="glyphicon glyphicon-alert"></span>
        <span class="glyphicon glyphicon-alert"></span>
        <span class="glyphicon glyphicon-alert"></span>
        <br />

        <br />
   
    <div ng-app="bookstoreApp" ng-controller="bookstoreCtrl">
        <div class="table table-striped table-bordered">
            <div class="dataTables_wrapper form-inline dt-bootstrap no-footer">
                <table datatable="ng" class="row-border hover">

                    <thead class="row">
                        <tr>

                            <th>ID</th>
                            <th>firstName</th>
                            <th>lastName</th>

                            <th>Draggie Droppie rest</th>
                        </tr>
                    </thead>



                    <tbody>
                        <tr ng-repeat="x in authors">
                            <td>{{ x.AuthorID}}</td>
                            <td>{{ x.FirstName }}</td>
                            <td><span ng-click="showBooksFromAuthor($index)">{{ x.LastName }} </span> </td>
                            <td>
                                <button id="{{x.AuthorID}}" ng-click="showBookForm(x.AuthorID)" class="glyphicon-plus-sign"></button>

                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <hr />
            <br /><br /><br />

            <!--<div ng-repeat="book in books" ng-show="bookFormShown">

                <label>Author:</label>
                <input type="text" id="bookFormAutor" ng-model="formAuthor.LastName" /><br />
                <ng-form ng-model="$scope.authors"
                <label>Book:</label>
                <input type="text" id="bookFormTitle" /><br />
                <label>Genre:</label>
                <input type="text" id="bookFormGenre" /><br />
                <label>Lent:</label>
                <input type="checkbox" style="will-change" id="bookFormLent" /><br />
                <label>Customer</label>
                    <input type="text" id="bookFormLentTo" ng-model="$scope.bookLentTo" />
                    <br /
                <button  ng-submit class="glyphicon-apple"></button>
                </ng-form>
            </div>

            <div ng-show='booksFromAuthorShown' class='col-md-9' id="booksFromAuthor">
                <label>Books:</label>


                <ul class="bs-glyphicons-list">
                    <li ng-repeat="book in books"><span class="glyphicon-class"></span></li>
                </ul>
            </div>-->
            <!-- refactor this to fit angular and VS service -->
            <div ng-show="bookFormShown">
                <div class="tab-content">
                    <!-- TAB BRANDS -->
                    <div class="tab-pane active" id="brands">
                        <h3 class="text-center">Borrowed Books</h3><br />
                        <div id='BorrowedBookPanel'>
                            <div id='borrowedBooksDiv' class='bookstore-panels clearfix'>

                                <div ng-repeat="borrowedBook in $scope.borrowedAuthorBooks" class="drag ui-widget-content bookstore-panel col-xs-3">
                                    <div class="bookstore-panel-logo">
                                        <img alt=borrowedBook.title class="monochrome vertical-center" src=borrowedBook.CoverImage draggable="true">
                                    </div>
                                </div>
                                

                            </div>
                            <h3 class="text-center">Available Books</h3><br>
                            <div id='availableBooksDiv' class="bookstore-panels">

                                <div ng-repeat="availableBook in $scope.availableAuthorBooks" class="drag ui-widget-content bookstore-panel col-xs-3">
                                    <div class="bookstore-panel-logo">
                                        <img alt=availableBook.title class="monochrome vertical-center" src=availableBook.CoverImage draggable="true">
                                    </div>
                                </div>
                               
                            </div>
                        </div>
                        <!-- END TAB BRANDS -->
                    </div>

                    <!--END refactor this to fit angular and VS service -->
                </div>
            </div>
            </div>
        </div>
            <script>
                $(function () {
                    $(".drag").draggable({ containment: "#containment-wrapper", scroll: false, snap: "#availableBooksDiv,#borrowedBooksDiv", snapMode: "inner" });
                });


                $("#BorrowedBooksPanel").droppable({
                    activeClass: "ui-state-hover",
                    hoverClass: "ui-state-active",
                    drop: function (event, ui) {
                        ui.draggable.draggable();
                        var id = ui.draggable.attr('alt');
                        $scope.books = $http
                        .get("http://localhost:49893/app/services/WebService.asmx/BorrowBook")
                        .then(function (response) {
                            $scope.books = response.data;
                            //$scope.authors = jQuery.xml2json($scope.authors)
                            $scope.members = $scope.members.slice(76, -9)
                            $scope.members = JSON.parse($scope.members)
                            console.log("memberi s posudjenim knjigama<br>", $scope.members);


                        }
                ).then(function successCallback(response) {
                    // this callback will be called asynchronously
                    // when the response is available
                    console.log("success borrowing borowing");
                }, function errorCallback(response) {
                    // called asynchronously if an error occurs
                    // or server returns response with an error status.
                    console.log("success borrowing borowing");
                });
                    }
                });

                $("#AvailableBooksPanel").droppable({
                    activeClass: "ui-state-hover",
                    hoverClass: "ui-state-active",
                    drop: function (event, ui) {
                        ui.draggable.draggable();
                        var id = ui.draggable.attr('alt');
                        $scope.books = $http
                        .get("http://localhost:49893/app/services/WebService.asmx/FreeBook")
                        .then(function (response) {
                            $scope.books = response.data;
                            //$scope.authors = jQuery.xml2json($scope.authors)
                            $scope.members = $scope.members.slice(76, -9)
                            $scope.members = JSON.parse($scope.members)
                            console.log("memberi s posudjenim knjigama<br>", $scope.members);


                        }
                ).then(function successCallback(response) {
                    // this callback will be called asynchronously
                    // when the response is available
                }, function errorCallback(response) {
                    // called asynchronously if an error occurs
                    // or server returns response with an error status.
                });
                    }
                });

            </script>

        
</body>
</html>

